# 并发控制
1. 控制子协程
- channel
  - 优点：实现简单
  - 缺点：channel需要和协程同样数量，而且对于子协程派生出来的协程不方便控制
- waitGroup
  - 前提学习：信号量
    - UNIX系统提供的一种保护共享资源的机制，用于防止多个线程同时访问某个资源
    - 可以简单理解为数值
      - 当信号量>0时，表示资源可用
      - 当信号量=0时，表示资源暂不可用
  - 数据结构
  ```
  type waitGroup struct{
        state1 [3]uint32
        // state1包含state和一个信号量，而state实际上是两个计数器
        // 1. counter: 当前还为执行结束的goroutine
        // 2. waiter count：等待goroutine-group结束的goroutine数量，即有多少个等候着
        // 3. semaphore 信号量
  }
  ```
  ![img.png](img.png)
    - 三个函数
      - Add()
      - Wait()
      - Done()：counter-1
- context
  - 优点： 可以控制多层的goroutine
  - 接口的4个方法
    - Deadline()
    - Done()
    - Err()
    - Value()
  - 实现Context的结构体
    - 空context(emptyCtx),作context的根节点
      - 包中定义:可使用context.Background()得到
      - 使用地方，创建不同类型context时，如果没有父context,都需要传background作为其父节点
        - WithCancel()
        - WithDeadline()
        - WithTimeout()
        - WithValue()
    - cancelCtx
    - timerCtx
    - valueCtx